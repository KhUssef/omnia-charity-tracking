export const VULNERABILITY_SCORE_SQL = `
  family.numberOfMembers
  + CASE WHEN family.containsElderlyMember = true THEN 1 ELSE 0 END
  + CASE WHEN family.containsDisabledMember = true THEN 1 ELSE 0 END
  + CASE WHEN family.containspupilMember = true THEN 1 ELSE 0 END
`;

export interface VulnerabilityFactors {
  numberOfMembers?: unknown;
  containsElderlyMember?: unknown;
  containsDisabledMember?: unknown;
  containspupilMember?: unknown;
}

export function computeVulnerabilityScore(factors: VulnerabilityFactors) {
  const numberOfMembers = Number(factors.numberOfMembers ?? 0) || 0;
  const disabled = toBoolean(factors.containsDisabledMember) ? 1 : 0;
  const elderly = toBoolean(factors.containsElderlyMember) ? 1 : 0;
  const pupils = toBoolean(factors.containspupilMember) ? 1 : 0;
  return numberOfMembers + disabled + elderly + pupils;
}

function toBoolean(value: unknown) {
  return value === true || value === 1 || value === '1';
}
